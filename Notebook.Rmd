---
title: ' '
output:
  html_document:
    theme: cosmo
    highlight: monochrome
    css: R_mesure_Marianne.css
    df_print: kable
  geometry: margin=0.1cm
  pdf_document: default
---
# Rapport stage prévision 


```{r package, include=FALSE}
library(haven)
library(dplyr)
library(utils)
library(forecast)
library(urca)
library(readxl)
library(tidyverse)
library(ggplot2) #pour le graphe
library(knitr)
library(RJDemetra)
source("function.R")
```

## Avancée et première prévision

J'ai utilisé le package RJDemetra conseillé par Eurostat. Il propose deux modèles : le modème TRAMO-SEATS et le modèle X13-ARIMA. Je me suis tout d'abord concentré sur le modèle X13 qui permet de désaisonnaliser les séries et de faire des prévisions assez rapidement et est assez adapatble pour interpréter la période COVID comme des outliers TC (temporary change). 




```{r plot_x13, echo=FALSE, error=FALSE}
t <- 24 #nombre de mois que l'on veut afficher avant le forecast


ALL <- penit_to_ts("ALL")
x13_model <- ts_to_X13(ALL)
ts_fcst <- x13_model$regarima$forecast
ts_s<- tail(x13_model$final$series[,1], t)

s <- start(ts_s)
s <- paste(s[1],s[2], "01", sep = "-")
sd <- as.Date(str_to_time(s)) #date de début
ld <- sd %m+% months(t + 23)
df <- data.frame(date = seq(1, t), fcst = as.numeric(ts_s), stderr_fcst = NA) 
df2 <- data.frame(date = seq(t + 1, t + 24), fcst = as.numeric(ts_fcst[,1]), stderr_fcst = as.numeric(ts_fcst[,2]))
df <- df %>%
  rbind(df2) %>%
  mutate(date = seq(sd, ld, by = "month"))

ggplot(data = df, aes(x = date, y = fcst)) + 
  geom_line() + 
  scale_x_continuous(breaks = seq(sd, ld, by = "month"), labels = seq(sd, ld, by = "month")) +
 
  geom_ribbon( aes (ymin = fcst - stderr_fcst, ymax = fcst + stderr_fcst), alpha = 0.2)

summary(x13_model$regarima)
```



